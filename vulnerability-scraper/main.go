// main.go
package main

import (
	"log"
	"time"
)

// --- 配置区 ---
// 根据你的本地MySQL配置进行修改
const dsn = "root:Pai3.1415926@tcp(127.0.0.1:3306)/shixi?charset=utf8mb4&parseTime=True"

// 设置要爬取的总页数 (建议从一个较小的值开始测试, 如 2)
const maxPagesToScrape = 2

// ----------------

func main() {
	log.Println("开始执行漏洞数据爬取程序...")

	// 初始化数据库
	db, err := NewDatabase(dsn)
	if err != nil {
		log.Fatalf("数据库连接失败: %v", err)
	}
	defer db.Close()
	log.Println("数据库连接成功.")

	// 创建爬虫实例
	cnvdScraper := NewScraper(db)

	startTime := time.Now()
	log.Printf("计划爬取 %d 页数据.", maxPagesToScrape)

	// 执行爬取
	cnvdScraper.Run(maxPagesToScrape)

	duration := time.Since(startTime)
	log.Printf("所有爬取任务完成, 总耗时: %v", duration)
}
